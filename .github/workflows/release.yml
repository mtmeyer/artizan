name: "ðŸš€ Release"

on:
  push:
    branches:
      - release

jobs:
  version:
    name: ðŸ”Ž Check version
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Get package version
        id: package-version
        uses: martinbeentjes/npm-get-version-action@master
      - name: Get previous release version
        id: previous-release-version
        uses: WyriHaximus/github-action-get-previous-tag@v1
      - name: Check if version has been bumped
        id: check-version-bump
        if: ${{ steps.package-version.outputs.current-version }} == ${{ steps.previous-release-version.outpus.tag }}
        uses: actions/github-script@v3
        with:
          script: |
            core.setFailed('You need to bump the version in package.json')

  release:
    name: ðŸš€ Release
    needs: [version]
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v2
      - name: Get package version
        id: package-version
        uses: martinbeentjes/npm-get-version-action@master
      - name: Create tag
        uses: rickstaa/action-create-tag@v1
        with:
          tag: ${{ steps.package-version.outputs.current-version }}
          message: "Latest release"
      - name: Create release
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ steps.package-version.outputs.current-version }}
